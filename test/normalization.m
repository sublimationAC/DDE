function [S R T result]=normalization(imageFiducialPoints,templateFiducialPoints)
q = imageFiducialPoints';
Q = templateFiducialPoints';
n=size(q,2);
% Subtract the mean from the points
qBar = sum(q,2)./n;
QBar = sum(Q,2)./n;
qBar
QBar
p = q - repmat(qBar,1,n);
P = Q - repmat(QBar,1,n);
size(p)
size(P)
% Use the equation given in the paper
A = p*P'/(P*P');

% Estimate translation
T = qBar - A*QBar;

% Estimate Rotation and Scale
[U,D,V] = svd([A; cross(A(1,:), A(2,:))]);

R = U*V';

S = A*R';

% Rotate, Scale and Translate the points to match the image
size(S*R*templateFiducialPoints')
size(T)
result=S*R*templateFiducialPoints'+repmat(T,1,n);





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   -0.155319   -0.196573   -0.117928
%   -0.122275   -0.202457   -0.138402
%  -0.0703791   -0.212317    -0.15357
%   -0.045445   -0.192763    -0.15218
%  -0.0831619   -0.191762   -0.144808
%    -0.11491   -0.189787   -0.138528
%    0.166264   -0.190818   -0.099298
%    0.123435   -0.212578   -0.131626
%   0.0709847    -0.20756   -0.148431
%   0.0383834   -0.187887   -0.146913
%     0.11319   -0.193974   -0.136106
%   0.0713183   -0.191273   -0.140996
%    0.140024   -0.150562   -0.106945
%   0.0891935    -0.17121   -0.132544
%   0.0469165   -0.148664   -0.131428
%   0.0955024   -0.138307   -0.130764
%   -0.149064   -0.155156   -0.103498
%   -0.102238   -0.172368   -0.135763
%  -0.0628161   -0.149919   -0.130662
%   -0.101318   -0.141879   -0.132338
%  0.00663469   -0.159861   -0.160375
%   0.0402687  -0.0971145   -0.162176
%   0.0497906  -0.0574806   -0.165663
%   0.0437425   -0.025354   -0.188062
%  -0.0076449  -0.0224399   -0.226046
%  -0.0630918   -0.026498   -0.180662
%   -0.061012   -0.056219   -0.176621
%  -0.0436971   -0.104141   -0.170619
%  -0.0264088   -0.162712    -0.15368
%   0.0159821  -0.0340607   -0.218447
%  -0.0427064  -0.0350848   -0.208974
%   0.0637852   0.0626376   -0.165935
%   0.0426968   0.0446144   -0.188555
%   0.0200896   0.0367372   -0.200563
%  -0.0112115   0.0344711   -0.206729
%   -0.036098   0.0344515   -0.200788
%   -0.064508   0.0428893   -0.184755
%  -0.0888063   0.0576384   -0.157458
%  -0.0619057   0.0701735   -0.176815
%  -0.0470364    0.076336   -0.189316
%  -0.0212099   0.0859561   -0.199864
%   0.0126039   0.0816349   -0.199208
%     0.04247   0.0735101   -0.180601
%   0.0140097   0.0613537   -0.193607
%  -0.0199347   0.0654714   -0.198159
%  -0.0379179   0.0634419   -0.191646
%  -0.0444614   0.0523667   -0.191165
% -0.00944232   0.0532676   -0.202057
%   0.0200286   0.0563057   -0.192332
%  -0.0202703    0.056138    -0.19143
% -0.00813358  -0.0492357   -0.243715
%    0.117087   -0.166559   -0.125599
%    0.117052   -0.144651   -0.121583
%   0.0739499   -0.143117   -0.131686
%   0.0658134   -0.166934   -0.131188
%  -0.0823002    -0.16702   -0.132579
%   -0.082921   -0.146135   -0.132772
%   -0.129907   -0.146206    -0.11838
%   -0.123318   -0.168948   -0.128681
%     365   227
%   355   222
%   342   225
%   334   228
%   344   229
%   356   227
%   282   225
%   290   221
%   305   222
%   315   228
%   304   228
%   290   226
%   283   244
% 297.5 243.5
%   311   242
% 297.5 243.5
%   366   244
%   351   237
%   340   242
%   353   244
%   321   241
%   318   256
%   308   270
%   312   275
%   324   275
%   337   275
%   341   270
%   333   256
%   333   241
%   315   271
%   333   273
%   299   294
%   307   290
%   315   288
%   320   289
%   327   289
%   335   291
%   343   297
%   332   299
%   325   300
%   317   300
%   312   299
%   305   298
%   308   294
%   319   295
%   328   295
%   329   293
%   321   293
%   312   293
%   320   294
%   324   266
%   289 243.5
%   289 243.5
% 304.5 242.5
% 304.5 242.5
%   345   238
%   346   243
%   359   244
%   358   239
%    0.111982     0.13658   -0.109165
%    0.111982     0.13658   -0.109165
%    0.111982     0.13658   -0.109165
%   0.0257851    0.211606   -0.148747
%   0.0257851    0.211606   -0.148747
%   0.0257851    0.211606   -0.148747
%   0.0257851    0.211606   -0.148747
%   0.0257851    0.211606   -0.148747
%   -0.052957    0.210514   -0.144535
%   -0.052957    0.210514   -0.144535
%   -0.052957    0.210514   -0.144535
%   -0.052957    0.210514   -0.144535
%   -0.143687    0.120552  -0.0979368
%   -0.143687    0.120552  -0.0979368
%   -0.143687    0.120552  -0.0979368
%   -0.155319   -0.196573   -0.117928
%   -0.122275   -0.202457   -0.138402
%  -0.0703791   -0.212317    -0.15357
%   -0.045445   -0.192763    -0.15218
%  -0.0831619   -0.191762   -0.144808
%    -0.11491   -0.189787   -0.138528
%    0.166264   -0.190818   -0.099298
%    0.123435   -0.212578   -0.131626
%   0.0709847    -0.20756   -0.148431
%   0.0383834   -0.187887   -0.146913
%     0.11319   -0.193974   -0.136106
%   0.0713183   -0.191273   -0.140996
%    0.140024   -0.150562   -0.106945
%   0.0891935    -0.17121   -0.132544
%   0.0469165   -0.148664   -0.131428
%   0.0955024   -0.138307   -0.130764
%   -0.149064   -0.155156   -0.103498
%   -0.102238   -0.172368   -0.135763
%  -0.0628161   -0.149919   -0.130662
%   -0.101318   -0.141879   -0.132338
%  0.00663469   -0.159861   -0.160375
%   0.0402687  -0.0971145   -0.162176
%   0.0497906  -0.0574806   -0.165663
%   0.0437425   -0.025354   -0.188062
%  -0.0076449  -0.0224399   -0.226046
%  -0.0630918   -0.026498   -0.180662
%   -0.061012   -0.056219   -0.176621
%  -0.0436971   -0.104141   -0.170619
%  -0.0264088   -0.162712    -0.15368
%   0.0159821  -0.0340607   -0.218447
%  -0.0427064  -0.0350848   -0.208974
%   0.0637852   0.0626376   -0.165935
%   0.0426968   0.0446144   -0.188555
%   0.0200896   0.0367372   -0.200563
%  -0.0112115   0.0344711   -0.206729
%   -0.036098   0.0344515   -0.200788
%   -0.064508   0.0428893   -0.184755
%  -0.0888063   0.0576384   -0.157458
%  -0.0619057   0.0701735   -0.176815
%  -0.0470364    0.076336   -0.189316
%  -0.0212099   0.0859561   -0.199864
%   0.0126039   0.0816349   -0.199208
%     0.04247   0.0735101   -0.180601
%   0.0140097   0.0613537   -0.193607
%  -0.0199347   0.0654714   -0.198159
%  -0.0379179   0.0634419   -0.191646
%  -0.0444614   0.0523667   -0.191165
% -0.00944232   0.0532676   -0.202057
%   0.0200286   0.0563057   -0.192332
%  -0.0202703    0.056138    -0.19143
% -0.00813358  -0.0492357   -0.243715
%    0.117087   -0.166559   -0.125599
%    0.117052   -0.144651   -0.121583
%   0.0739499   -0.143117   -0.131686
%   0.0658134   -0.166934   -0.131188
%  -0.0823002    -0.16702   -0.132579
%   -0.082921   -0.146135   -0.132772
%   -0.129907   -0.146206    -0.11838
%   -0.123318   -0.168948   -0.128681















